(function(e,t){e.sobox={maskIndex:0,showMask:function(n){var r=this;if(n){var i=e(".so-openmask");i.length?r.maskIndex++:(i=e('<div class="so-openmask"></div>'),e("body").append(i),r.maskIndex=1);var s=typeof t.body.style.maxHeight=="undefined"?t:window,o=e(s).height()-18;i.height(n?o+20:0),e(window).resize(function(){var t=e(s).height()-18;i.height(n?t+20:0)}),i.css("z-index",1e3+r.maskIndex*10)}else i=null;return i},show:function(t,n,r){var i=this,s=e(t.obj),o=i.showMask(n);return i.setPos(t),t.onlyOne&&e("body").data("soonlyone",!0),s.css("z-index",1002+i.maskIndex*10).fadeIn(),s.find(".s-close").bind("click",function(){i.hide(s)}),r&&r(),o},hide:function(t,n,r){var i=this,s=e(".so-openmask");e(t).fadeOut("fast",function(){r&&r()}),n&&(i.maskIndex--,s.css("z-index",1e3+i.maskIndex*10),i.maskIndex==0&&s.remove()),e(t).find(".s-close").unbind("click")},drag:function(n,r){function o(e){e==null&&(e=window.event),i.css({left:e.clientX-posX+"px",top:e.clientY-posY+"px"})}var i=e(n),s=e(r);s.mousedown(function(n){n||(n=window.event),posX=n.clientX-parseInt(i.css("left")),posY=n.clientY-parseInt(i.css("top")),e(t).bind("mousemove.drag",function(e){o(e)})}),e(t).mouseup(function(n){n.target==s.get(0)&&e(t).unbind("mousemove.drag")})},setPos:function(n){var r=this,n=e.extend({mode:"center",obj:null,pos:[0,0],offset:[0,0]},n),i=e(n.obj),s=Math.floor(i.height()/2),o=Math.floor(i.width()/2),u=e(window).scrollTop(),a=e(window).height(),f=n.pos[0],l=n.pos[1],c=n.offset[0],h=n.offset[1];i.css({position:"fixed"});if(typeof t.body.style.maxHeight=="undefined"){var p=i.find("select");e("select").not(p).hide()}switch(n.mode){case"win":i.css({left:f+c,top:l+h}),typeof t.body.style.maxHeight=="undefined"&&i.css({position:"absolute",top:u+l+h});break;case"doc":i.css({position:"absolute",left:f+c,top:l+h});break;case"tc":i.css({left:"50%",top:h,marginLeft:-o+c}),typeof t.body.style.maxHeight=="undefined"&&i.css({position:"absolute",top:u+h});break;case"bc":i.css({left:"50%",bottom:h,marginLeft:-o+c}),typeof t.body.style.maxHeight=="undefined"&&i.css({position:"absolute",top:u+h+a});break;default:i.css({top:"50%",left:"50%",marginTop:-s-10+h,marginLeft:-o+c}),typeof t.body.style.maxHeight=="undefined"&&i.css({position:"absolute",top:u+a/2})}},pop:function(t){function f(a){a&&a.disableEvents&&e("body").addClass("disableEvents"),t=e.extend(t,a||{}),t.showTitle&&i.append(s),t.outCloseBtn&&o.addClass("s-sopop-out-close"),i.append(o).append(u),t.height&&t.type!="iframe"&&i.css("height",t.height+"px"),i.css({visibility:t.visibility?"visible":"hidden"}),t.type=="content"&&u.html(t.content);if(t.type=="target"){var f=e(t.target).show();u.append(f)}if(t.type=="iframe"){var c=e('<iframe id="'+t.iframeID+'" name="'+t.iframeID+'" src="'+t.iframe+'" width="100%" height="'+t.height+'" frameborder="0" scrolling="auto"></iframe>');u.html(c)}t.type=="ajax"&&u.load(t.ajax.url,t.ajax.data,function(){n.setPos({mode:t.posType,obj:i,pos:t.pos,offset:t.offset}),t.ajax.callback&&t.ajax.callback()});if(t.btn.length>0){var h=e('<p class="p-so-popBtn"></p>');e.each(t.btn,function(){var t=e.extend({cls:null,text:"确定",link:"#",removePop:!0,callback:function(e){}},this),n=e('<a class="a-sopop-btn" href="'+t.link+'"><span class="s-sopop-btn">'+t.text+"</span></a>");t.cls!==null&&n.addClass(t.cls),n.bind("click",function(){return t.callback&&t.callback(l)&&l(),t.removePop&&l(),t.link==="#"?!1:!0}),h.append(n)}),i.append(h)}e("body").append(i),t.showTitle&&t.drag&&(s.addClass("h2-sopop-move"),n.drag(i,s)),t.beforePop(i,s,o,u),r=n.show({mode:t.posType,obj:i,pos:t.pos,offset:t.offset,onlyOne:t.onlyOne},t.showMask,t.onPop(i)),o.bind("click",function(){l()}),r&&t.maskClick&&r.bind("click",function(){l()})}function l(r){t=e.extend(t,r||{}),n.hide(i,t.showMask),e("body").removeData("soonlyone"),t.target!=null&&e(t.target).appendTo("body").hide(),i.remove(),t.closePop(),e("body").removeClass("disableEvents")}var n=this,t=e.extend({type:"content",target:null,content:null,iframe:null,iframeID:"sopop-iframe",ajax:{url:null,data:null,callback:function(){}},posType:"center",pos:[0,0],offset:[0,0],cls:null,width:400,height:null,defaultShow:!0,visibility:!0,title:"提示",showTitle:!0,outCloseBtn:!1,showMask:!0,onlyOne:!1,drag:!0,maskClick:!1,btn:[],disableEvents:!1,beforePop:function(){},onPop:function(){},closePop:function(){}},t||{}),r,i=e('<div class="so-popbox '+(t.cls?t.cls:"")+'" style="width:'+t.width+'px;display:none;"></div>'),s=e('<h2 class="h2-sopop"><span class="s-sopop-title">'+t.title+"</span></h2>"),o=e('<span class="s-sopop-close">[关闭]</span>'),u=e('<div class="so-popbox-cont"></div>'),a=e("body").data("soonlyone");return t.defaultShow&&!a&&f(t),{wrap:i,mask:r,opt:t,removePop:l,showPop:f}},alert:function(e,t,n){var r=this;r.pop({cls:"so-popAlert",title:e,width:360,content:t,btn:[{text:"确定"}],closePop:n})},confirm:function(e,t,n,r){var i=this;i.pop({cls:"so-popConfirm",title:e,width:360,content:t,btn:[{text:"确定",callback:function(){n&&n()}},{text:"取消",cls:"a-sopop-cancel",callback:function(){r&&r()}}]})},tip:function(t){var n=this,r=null,t=e.extend({cls:"so-popTip",showTitle:!1,posType:"tc",showMask:!1,width:250,stayTime:5e3,offset:[0,5],closePop:function(){r&&clearTimeout(r)}},t||{}),i=n.pop(t);return t.stayTime>0&&(r=setTimeout(function(){i.removePop()},t.stayTime)),i},loading:function(t){var n=this,t=e.extend({type:"content",cls:"so-loading",showTitle:!1,maskClick:!1,width:100,height:36,content:"",stayTime:0,showMask:!1,disableEvents:!0},t||{}),r=n.pop(t);return t.stayTime>0&&setTimeout(function(){r.removePop()},t.stayTime),{open:r.showPop,close:r.removePop}}},e.fn.extend({soIframePop:function(t){var n=e.extend({type:"iframe",targetTag:"href",splitString:"#soIframe?",width:800,height:480,showTitle:!1},t||{}),r=[];return this.each(function(){var t=e(this),i=t.attr(n.targetTag).split(n.splitString),s=i[0];par=i[1]?i[1].split("&"):"";var u={};e.each(par,function(){var e=this.split("=");u[e[0]]=e[1]}),n=e.extend(n,u||{}),n.showTitle=n.showTitle=="true"?1:+n.showTitle,n.iframe=s,n.defaultShow=!1;var a=e.sobox.pop(n);r.push(a),t.click(function(){return a.showPop(),e(this).data("iframePop",a),!1})}),r},soSidePop:function(t){var n=e(this),r=t.event||"click",i=null;return n.bind(r,function(n){var r=e(this).offset(),s=t.por=="mouse"?[n.pageX,n.pageY]:[r.left,r.top],o=e.extend({showMask:!1,posType:"doc",por:"mouse",pos:s,offset:[10,10],onlyOne:!0,returnFalse:!0},t||{});i=e.sobox.pop(o);if(o.returnFalse)return!1}),t.leaveHide==1&&n.bind("mouseout",function(e){i&&i.removePop()}),n},soOverTip:function(t){var n=e(this),r=e.extend({cls:"so-overTip",showMask:!1,posType:"doc",offset:[10,10],showTitle:!1,onlyOne:!0},t||{}),i=null;return n.mouseenter(function(t){r.pos=[t.pageX,t.pageY],i=e.sobox.pop(r)}).mouseleave(function(){i.removePop()}),n},clickPop:function(t){var t=e.extend({optAll:null},t||{}),n=e(this);n.click(function(){var n=e(this).attr("rel"),r=this,s=e(this).attr("popType")||"target";if(n){var u=t.optAll,a=n.split("."),f=a.length;for(i=0;i<f;i++)u=u[a[i]];var l=n.replace(".","_");optT=e.extend({title:e(this).text(),type:s,target:e("#"+l),iframe:e(this).attr("href")},u),optT.beforePop=function(e,t,n,i){u.beforePop&&u.beforePop.call(r,e,t,n,i)},t.optAll.$pop=e.sobox.pop(optT)}})}})})(jQuery,document);