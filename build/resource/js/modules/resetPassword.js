(function(e){var t={init:function(){var e=this.getStep();this[e]()},getStep:function(){var t,n=["step1","step2","step3","step4","error"];for(var r=0,i=n.length;r<i;r++){var s=n[r];if(e("."+s).length){t=s;break}}return t},step1:function(){var t=e("#errorCode").val();if(t){var n=this.getErrMsg(t);e.sobox.alert("系统提示",'<div style="padding:10px 0">'+n+"</div>",function(){})}var r=document.getElementById("input-box"),i=r.getElementsByTagName("input"),s=e("#email"),o=e("#code"),u=e("#email-err-tips"),a=e("#code-err-tips"),f=s.attr("placeholder"),l=o.attr("placeholder"),c=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,h=e(".code").attr("src");e("#input-box .txt").on("focus",function(){var t=e(this),n=t.attr("placeholder"),r=t.val();r==n&&t.val(""),t.addClass("txt-focus")}).on("blur",function(){var t=e(this),n=t.attr("placeholder"),r=t.val();r==""&&t.val(n),t.removeClass("txt-focus")});var p=function(){var e=s.val(),t=o.val();return e==""||e==f?(u.text("请输入邮箱地址").show(),s.focus(),!1):c.test(e)?(u.hide(),t==""||t==l?(a.text("请输入验证码").show(),o.focus(),!1):(a.hide(),!0)):(u.text("请输入正确的邮箱地址").show(),s.focus(),!1)};e("#form").on("submit",function(){if(!p())return!1}),e(".code").on("click",function(){e(this).attr("src",h+"&r="+Math.random())})},step2:function(){},step3:function(){var t=e("#pwd1"),n=e("#pwd2"),r=e("#errorCode").val();if(r){var i=this.getErrMsg(r);e.sobox.alert("系统提示",'<div style="padding:10px 0">'+i+"</div>",function(){})}var s=this,o=e("#input-box"),u=o.find("input");u.on("focus",function(){e(this).addClass("txt-focus")}).on("blur",function(){e(this).removeClass("txt-focus")}),e("#form").on("submit",function(){if(!s.checkPwd())return!1;t.val(CryptoJS.MD5(t.val()).toString().toUpperCase()),n.val(CryptoJS.MD5(n.val()).toString().toUpperCase())})},step4:function(){},error:function(){},getErrMsg:function(e){var t={MAIL_VALIDATE_FAILED:"系统邮箱验证失败",MAIL_NOT_BOUND:"该邮箱未被绑定",MAIL_BOUND_REPEAT:"该邮箱重复绑定",MAIL_SERVICE_CLOSE:"未开通发送邮件服务,请联系管理员重置密码",MAIL_SEND_FAILED:"邮件发送失败,请联系管理员",VALIDATION_CODE_ERROR:"图片验证码错误,请重新输入",USER_EMAIL_ERROR:"邮箱格式错误",PARAM_IS_NULL:"参数为空"};return t[e]||"未知错误("+e+")"},checkPwd:function(){var t=e("#pwd1"),n=e("#pwd2"),r=e("#err-tips1"),i=e("#err-tips2"),s=e("#err-tips3"),o=t.val(),u=n.val(),a={},f;try{var l=global.rules}catch(c){return e.sobox.alert("系统提示",'<div style="padding:10px 0">获取密码规则失败！</div>',function(){}),!1}var h=["length","spChar","caps","weak","timeout"];if(o=="")return r.text("请输入新密码").show(),t.focus(),!1;for(var p=0,d=l.length;p<d;p++){var v=l[p],m=v.ruleId;a[h[m-1]]=v}var g=a.length.ruleValue;if(o.length<~~a.length.ruleValue)return r.text("请输入至少"+a.length.ruleValue+"个字符的密码").show(),t.focus(),!1;if(a.spChar.isCheck){f=new RegExp(a.spChar.ruleValue);if(!f.test(o))return r.text("必须包含特殊字符,如!@#$%^&*.").show(),t.focus(),!1}if(a.caps.isCheck){f=new RegExp(a.caps.ruleValue);if(!f.test(o))return r.text("必须包含大写字母").show(),t.focus(),!1}if(a.weak.isCheck){f=new RegExp(a.weak.ruleValue);if(f.test(o))return r.text("禁止使用弱密码，如一种字符或连续字符").show(),t.focus(),!1}return r.hide(),u==""?(i.show(),n.focus(),!1):(i.hide(),o!=u?(s.show(),!1):(s.hide(),!0))}};t.init()})(jQuery);