define(["jquery","underscore","backbone","controls/Common","text!../../template/pager.html","controls/Dialog"],function(e,t,n,r,i,s){return n.View.extend({initialize:function(e){this.dataModel=e.dataModel,this.listenTo(this.dataModel,"change",this.render),this.render()},render:function(){var e=this.model.toJSON(),n=this.dataModel.toJSON(),s=Math.ceil(n.total/n.pageSize),o=t.extend({total:0,pageIndex:1,pageSize:10,pageCount:s||0},e,n),u=r.tpl2Html(i,o);this.$el.html(u),this.setBtnStatus(o)},events:{"change .pageSize":"changePageSize","click .i-page-first":"firstPage","click .i-page-prev":"prevPage","keyup .pageInput":"goPage","click .i-page-next":"nextPage","click .i-page-last":"lastPage","click .i-page-reload":"reload"},changePageSize:function(t){var n=e(t.currentTarget).val();this.model.set({pageIndex:1,pageSize:~~n})},firstPage:function(){this.model.set({pageIndex:1})},lastPage:function(){var e=this.dataModel.attributes,t=Math.ceil(e.total/e.pageSize);if(t==0)return;this.model.set({pageIndex:t})},prevPage:function(){var e=this.model.attributes.pageIndex,t=e-1;this.model.set({pageIndex:t>1?t:1})},nextPage:function(){var e=this.model.attributes.pageIndex,t=this.dataModel.attributes,n=Math.ceil(t.total/t.pageSize),r=e+1>n?n:e+1;if(n==0||r==0)return;this.model.set({pageIndex:r})},goPage:function(t){if(t.keyCode!=13)return;var n=e(t.currentTarget).val(),r=this.dataModel.attributes,i=Math.ceil(r.total/r.pageSize);if(!/^\+?[1-9][0-9]*$/.test(n)||n<1||n>i){s.tips("请输入正确的页码数！"),e(t.currentTarget).val(this.model.get("pageIndex"));return}this.model.set({pageIndex:~~n})},reload:function(){this.getData()},setBtnStatus:function(t){var n=t.pageIndex,r=t.pageCount,i=e(".i-page-first"),s=e(".i-page-prev"),o=e(".i-page-next"),u=e(".i-page-last");n<=1&&(i.addClass("i-page-first-disabled"),s.addClass("i-page-prev-disabled")),n>=r&&(o.addClass("i-page-next-disabled"),u.addClass("i-page-last-disabled"))},getData:function(){this.model.trigger("change")},destroy:function(){this.undelegateEvents(),this.stopListening()}})});