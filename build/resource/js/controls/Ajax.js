define(["jquery","underscore","controls/Dialog","json2"],function(e,t,n,r){var i={requestId:0,loadingObj:{},defaultOpts:{type:"POST",data:{},dataType:"json",success:function(){},error:function(){i.loadingObj.close&&i.loadingObj.close(),n.tips("Error Request !")},contentType:"text/plain; charset=UTF-8"},request:function(r,i,s){this.requestId++;var o=this;if(!r.url)return;this.url=r.url,s||(o.loadingObj.close&&o.loadingObj.close(),o.loadingObj=n.loading()),r.data&&r.data.parse&&delete r.data.parse,r.data&&r.data.success&&delete r.data.success,r.data&&r.data.error&&delete r.data.error,r.fail=r.fail||function(e){n.tips("Error:"+e.code)},e.ajax(t.extend({},this.defaultOpts,r,{data:JSON.stringify(r.data),success:function(e){s||o.loadingObj.close();if(!e)return;i?r.success(e):e&&e.code&&e.code=="S_OK"&&e.hasOwnProperty("var")?r.success(e["var"]):r.fail({code:e.code,errorCode:e.errorCode,summary:e.summary})},error:function(e){s||o.loadingObj.close();if(e.status==200||e.status==0){n.tips("登录超时，请重新登录"),t.delay(function(){window.location.reload()},2e3);return}r.fail(e)}}))}};return i});